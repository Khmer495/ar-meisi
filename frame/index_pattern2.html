<!DOCTYPE html>
<html>

<head>
  <meta charset='utf-8'>
  <meta name='viewport' content='width=device-width,initial-scale=1'>
  <meta name='apple-mobile-web-app-capable' content='yes'>
  <title>AR名刺</title>
  <script src='https://aframe.io/releases/0.9.2/aframe.min.js'></script>
  <script src='https://jeromeetienne.github.io/AR.js/aframe/build/aframe-ar.js'></script>
</head>

<body style='margin:0px; overflow:hidden;'>
  <a-scene embedded arjs='debugUIEnabled: false; patternRatio: 0.9; maxDetectionRate: 5;'>
    <a-assets>
        <video id='img_load' src='img/load.mp4' autoplay loop='ture' playsinline muted></video>
        <img id='img_load' src='img/load.png'></img>
        <video id='img_back' src='img/back.mp4' autoplay loop='ture' playsinline muted></video>
        <img id='img_back' src='img/back.png'></img>
        <img id='img_prof' src='img/prof.png'>
        <img id='img_mail' src='img/mail_white.png'>
        <img id='img_mail' src='img/mail_black.png'>
        <img id='img_tel' src='img/tel_white.png'>
        <img id='img_tel' src='img/tel_black.png'>
        <img id='img_twitter' src='img/twitter.png'>
        <img id='img_facebook' src='img/facebook.png'>
        <img id='img_instagram' src='img/instagram.png'>
        <img id='img_github' src='img/github_white.png'>
        <img id='img_github' src='img/github_black.png'>
    </a-assets>

    <a-marker preset='custom' type='pattern' url='marker/marker.patt' marker>
      <!--load画面-->
      <a-plane id='ent_load_plane' width='20' height='20' position='0 0.5 0' rotation='-90 0 0' scale='0 0 0' opacity='0'
        animation__start='property: scale; dur: 1000; to: 1 1 1; easing: linear; enabled: false;'
        animation__wait='property: scale; dur: 4000; startEvents: animationcomplete__start;'
        animation__end='property: scale; dur: 1000; to: 0 0 0; easing: linear; startEvents: click, animationcomplete__wait;'>
        <a-video id='ent_load' src='#img_load' width=null height=null scale='3.5 3.5 3.5'>
        </a-video>
      </a-plane>

      <!--背景-->
      <a-video id='ent_back' src='#img_back' width=null height=null position='0 0.5 0' rotation='-90 0 0' scale='0 0 0'
        animation__end='property: scale; dur: 1000; to: 3.5 3.5 3.5; easing: linear; startEvents: start;'>
      </a-video>

      <!--プロフィール画像-->
      <a-image id='ent_prof' src='#img_prof' width=null height=null position='-2 1 -0.5' rotation='-90 0 0' scale='0 0 0' opacity='0'
        animation__start='property: scale; dur: 1; to: 1.5 1.5 1.5; easing: linear; startEvents: start;'
        animation__end='property: opacity; dur: 2000; to: 1; easing: linear; startEvents: start;'>
      </a-image>

      <!--名前-->
      <!--1つの場合-->
      <!--
      <a-text id='ent_name' position='1 1 -1.17' rotation='-90 0 0' scale='0 0 0' opacity='0'
        value=null font='font/name-msdf.json' negate='false' align='center'
        animation__start='property: scale; dur: 1; to: 1.5 1.5 1.5; easing: linear; startEvents: start;'
        animation__end='property: opacity; dur: 2000; to: 1; easing: linear; startEvents: start;'>
      </a-text>
    -->
      <!--2つの場合-->
      <a-entity id='ent_name' position='1 1 -1.17' rotation='-90 0 0'
        animation__end='property: scale; dur: 2000; startEvents: start;'>
        <a-text id='ent_name_ja'  scale='0 0 0' opacity='0'
          value=null font='font/name-msdf.json' negate='false' align='center'
          animation__start='property: scale; dur: 1; to: 1.5 1.5 1.5; easing: linear; startEvents: start;'
          animation__start_2='property: opacity; dur: 2000; to: 1; easing: linear; startEvents: animationcomplete__start;'
          animation__wait='property: scale; dur: 6000; startEvents: animationcomplete__start_2;'
          animation__end_2='property: opacity; dur: 2000; to: 0; easing: linear; startEvents: animationcomplete__wait;'
          animation__end='property: scale; dur: 1; to: 0 0 0; easing: linear; startEvents: animationcomplete__end_2;'>
        </a-text>
        <a-text id='ent_name_en' scale='0 0 0' opacity='0'
          value=null font='font/name-msdf.json' negate='false' align='center'
          animation__start='property: scale; dur: 1; to: 1.5 1.5 1.5; easing: linear; startEvents: start;'
          animation__start_2='property: opacity; dur: 2000; to: 1; easing: linear; startEvents: animationcomplete__start;'
          animation__wait='property: scale; dur: 6000; startEvents: animationcomplete__start_2;'
          animation__end_2='property: opacity; dur: 2000; to: 0; easing: linear; startEvents: animationcomplete__wait;'
          animation__end='property: scale; dur: 1; to: 0 0 0; easing: linear; startEvents: animationcomplete__end_2;'>
        </a-text>
      </a-entity>

      <!--紹介-->
      <a-text id='ent_intro' position='1 1 -0.17' rotation='-90 0 0' scale='0 0 0' opacity='0'
        value=null font='font/intro-msdf.json' negate='false' align='center'
        animation__start='property: scale; dur: 1; to: 0.75 0.75 0.75; easing: linear; startEvents: start;'
        animation__end='property: opacity; dur: 2000; to: 1; easing: linear; startEvents: start;'>
      </a-text>

      <!--メール-->
      <a-image id='ent_mail_icon' src='#img_mail' width='1' height=' 1' position='-0.3 1 0.75' rotation='-90 0 0' scale='0 0 0' opacity='0'
        animation__start='property: scale; dur: 1; to: 0.4 0.4 0.4; easing: linear; startEvents: start;'
        animation__end='property: opacity; dur: 1000; to: 1; easing: linear; startEvents: start;'>
      </a-image>
      <a-text id='ent_mail_text' position='0.2 1 0.75' rotation='-90 0 0' scale='0 0 0' opacity='0'
        value=null font='font/info-msdf.json' negate='false' align='left'
        animation__start='property: scale; dur: 1; to: 1 1 1; easing: linear; startEvents: start;'
        animation__end='property: opacity; dur: 1000; to: 1; easing: linear; startEvents: start;'>
      </a-text>

      <!--電話-->
      <a-image id='ent_tel_icon' src='#img_tel' width='1' height=' 1' position='-0.3 1 1.25' rotation='-90 0 0' scale='0 0 0' opacity='0'
        animation__start='property: scale; dur: 1; to: 0.4 0.4 0.4; easing: linear; startEvents: start;'
        animation__end='property: opacity; dur: 1000; to: 1; easing: linear; startEvents: start;'>
      </a-image>
      <a-text id='ent_tel_text' position='0.2 1 1.25' rotation='-90 0 0' scale='0 0 0'
        value=null font='font/info-msdf.json' negate='false' align='left'
        animation__start='property: scale; dur: 1; to: 1 1 1; easing: linear; startEvents: start;'
        animation__end='property: opacity; dur: 1000; to: 1; easing: linear; startEvents: start;'>
      </a-text>

      <!--twitter-->
      <a-image id='ent_twitter' src='#img_twitter' width='1' height=' 1' position='-0.5 1 1' rotation='-90 0 0' scale='0 0 0' opacity='0'
        animation__start='property: scale; dur: 1; to: 0.8 0.8 0.8; easing: linear; startEvents: start;'
        animation__end='property: opacity; dur: 1000; to: 1; easing: linear; startEvents: start;'>
      </a-image>

      <!--facebook-->
      <a-image id='ent_facebook' src='#img_facebook' width='1' height=' 1' position='0.5 1 1' rotation='-90 0 0' scale='0 0 0' opacity='0'
        animation__start='property: scale; dur: 1; to: 0.8 0.8 0.8; easing: linear; startEvents: start;'
        animation__end='property: opacity; dur: 1000; to: 1; easing: linear; startEvents: start;'>
      </a-image>

      <!--instagram-->
      <a-image id='ent_instagram' src='#img_instagram' width='1' height=' 1' position='1.5 1 1' rotation='-90 0 0' scale='0 0 0' opacity='0'
        animation__start='property: scale; dur: 1; to: 0.8 0.8 0.8; easing: linear; startEvents: start;'
        animation__end='property: opacity; dur: 1000; to: 1; easing: linear; startEvents: start;'>
      </a-image>

      <!--github-->
      <a-image id='ent_facebook' src='#img_github' width='1' height=' 1' position='2.5 1 1' rotation='-90 0 0' scale='0 0 0' opacity='0'
        animation__start='property: scale; dur: 1; to: 0.8 0.8 0.8; easing: linear; startEvents: start;'
        animation__end='property: opacity; dur: 1000; to: 1; easing: linear; startEvents: start;'>
      </a-image>
    </a-marker>

    <!-- AR用のカメラを置く -->
    <a-entity camera>
      <a-entity cursor='fuse: false; rayOrigin: mouse'></a-entity>
    </a-entity>

  </a-scene>

  <input id='copy_mail' type='text' style='width: 0; height: 0;' value=null/>
  <input id='copy_tel' type='text' style='width: 0; height: 0;' value=null/>

  <script>
      //入力値
      //name
      (function(){
          let txt_ja = '';
          let txt_en = '';
          document.getElementById('ent_name_ja').setAttribute('value', txt_ja);
          document.getElementById('ent_name_en').setAttribute('value', txt_en);
      }());
      //intro
      (function(){
          let txt = '';
          document.getElementById('ent_intro').setAttribute('value', txt);
      }());
      //mail
      (function(){
          let txt = '';
          document.getElementById('ent_mail_text').setAttribute('value', txt);
          document.getElementById('copy_mail').setAttribute('value', txt);
      }());
      //tel
      (function(){
          let txt = '';
          document.getElementById('ent_tel_text').setAttribute('value', txt);
          document.getElementById('copy_tel').setAttribute('value', txt);
      }());
      let link_twitter = '';
      let link_facebook = '';
      let link_instagram = '';
      let link_github = '';

    //サイズ指定
    //load
    let scale = 2;
    (function(){
        /*
        let img_width = 800;
        let img_height = 308;
        let val = Math.min(img_width, img_height);
        let ent_width = img_width / val;
        let ent_height = img_height / val;
        */
        let ent_width = scale;
        let ent_height = 1;
        let ent = document.getElementById('ent_load');
        ent.setAttribute('width', ent_width);
        ent.setAttribute('height', ent_height);
    }());
    //back
    (function(){
        /*
        let img_width = 600;
        let img_height = 308;
        let val = Math.min(img_width, img_height);
        let ent_width = img_width / val;
        let ent_height = img_height / val;
        */
        let ent_width = scale;
        let ent_height = 1;
        let ent = document.getElementById('ent_back');
        ent.setAttribute('width', ent_width);
        ent.setAttribute('height', ent_height);
    }());
    //prof
    (function(){
        let img_width = 476;
        let img_height = 559;
        let val = Math.min(img_width, img_height);
        let ent_width = img_width / val;
        let ent_height = img_height / val;
        let ent = document.getElementById('ent_prof');
        ent.setAttribute('width', ent_width);
        ent.setAttribute('height', ent_height);
    }());

    // 配置
    // prof
    (function(){
        let x = -scale;
        let z = -0.5;
        let ent = document.getElementById('ent_prof');
        ent.setAttribute('position', x + ' 1 ' + z);
    }());

    // name
    (function(){
        let x = scale/2;
        let z = -1.5+1/3;
        let ent = document.getElementById('ent_name');
        ent.setAttribute('position', x + ' 1 ' + z);
    }());

    // intro
    (function(){
        let x = scale/2;
        let z = -1.5+4/3;
        let ent = document.getElementById('ent_intro');
        ent.setAttribute('position', x + ' 1 ' + z);
    }());

    // icon
    // n：アイコン数
    // i：0~n
    // 数に応じて調整
    /*
    (function(){
        // x = -scale*3 + scale*3/n/2*(2*i+1)
        let x = null;
        let z = -1;
        let ent = document.getElementById('ent_');
        ent.setAttribute('position', x + ' 1 ' + z);
    }());
    */

    AFRAME.registerComponent('marker', {
      init: function () {

        // アニメーション
        // マーカー検出・ロード
        var marker = this.el;
        marker.addEventListener('markerFound', function () {
          document.getElementById('img_load').play();
          document.getElementById('ent_load_plane').setAttribute('animation__start', 'enabled: true');
        });
        // 背景
        document.getElementById('ent_load_plane').addEventListener('animationcomplete__end', function () {
          document.getElementById('img_load').pause();
          document.getElementById('img_back').play();
          document.getElementById('ent_back').emit('start');
        });
        // 名前・画像
        document.getElementById('ent_back').addEventListener('animationcomplete__end', function () {
          document.getElementById('ent_name').emit('start');
          document.getElementById('ent_name_ja').emit('start');
          document.getElementById('ent_prof').emit('start');
        });
        // 名前（2つの場合）
        document.getElementById('ent_name_ja').addEventListener('animationcomplete__end', function () {
          document.getElementById('ent_name_en').emit('start');
        });
        document.getElementById('ent_name_en').addEventListener('animationcomplete__end', function () {
          document.getElementById('ent_name_ja').emit('start');
        });
        // 紹介
        document.getElementById('ent_name').addEventListener('animationcomplete__end', function () {
          document.getElementById('ent_intro').emit('start');
        });
        // メール
        document.getElementById('ent_intro').addEventListener('animationcomplete__end', function () {
          document.getElementById('ent_mail_icon').emit('start');
          document.getElementById('ent_mail_text').emit('start');
        });
        // 電話
        document.getElementById('ent_mail_icon').addEventListener('animationcomplete__end', function () {
          document.getElementById('ent_tel_icon').emit('start');
          document.getElementById('ent_tel_text').emit('start');
        });
        // twitter
        document.getElementById('ent_tel_icon').addEventListener('animationcomplete__end', function () {
          document.getElementById('ent_twitter').emit('start');
        });
        // facebook
        document.getElementById('ent_twitter').addEventListener('animationcomplete__end', function () {
          document.getElementById('ent_facebook').emit('start');
        });
        // instagram
        document.getElementById('ent_facebook').addEventListener('animationcomplete__end', function () {
          document.getElementById('ent_instagram').emit('start');
        });
        // github
        document.getElementById('ent_instagram').addEventListener('animationcomplete__end', function () {
          document.getElementById('ent_github').emit('start');
        });

        // クリックイベント
        // コピー
        document.getElementById('ent_mail_icon').addEventListener('click', function () {
          let txt = document.getElementById('copy_mail');
          txt.select();
          let range = document.createRange();
          range.selectNode(txt);
          let selection = document.getSelection();
          selection.removeAllRanges();
          selection.addRange(range);
          document.execCommand('copy');
        });
        document.getElementById('ent_tel_icon').addEventListener('click', function () {
          let txt = document.getElementById('copy_tel');
          txt.select();
          let range = document.createRange();
          range.selectNode(txt);
          let selection = document.getSelection();
          selection.removeAllRanges();
          selection.addRange(range);
          document.execCommand('copy');
        });

        // リンク
        document.getElementById('ent_twitter').addEventListener('click', function () {
          window.open(link_twitter, '_blank');
        });
        document.getElementById('ent_facebook').addEventListener('click', function () {
          window.open(link_facebook, '_blank');
        });
        document.getElementById('ent_instagram').addEventListener('click', function () {
          window.open(link_twitter, '_blank');
        });
        document.getElementById('ent_github').addEventListener('click', function () {
          window.open(link_facebook, '_blank');
        });
      }
    });
  </script>
</body>

</html>
